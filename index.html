<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FunTimeChat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#fff}
.hidden{display:none}
.header{background:#020617;padding:12px;text-align:center;font-weight:bold}
#messages{height:70vh;overflow:auto;padding:10px}
.msg{background:#1e293b;padding:8px;border-radius:8px;margin:5px 0;max-width:80%}
.me{margin-left:auto;background:#2563eb}
.sendBar{display:flex;position:fixed;bottom:55px;width:100%;background:#020617;padding:8px}
.sendBar input{flex:1;padding:10px;border-radius:8px;border:none}
.sendBar button{margin-left:6px;padding:10px;border:none;border-radius:8px;background:#22c55e}
.bottomNav{position:fixed;bottom:0;width:100%;background:#020617;display:flex;justify-content:space-around;padding:10px 0}
.navBtn{font-size:13px}
.loginBox{padding:20px;margin-top:80px}
.btn{width:100%;padding:12px;margin:10px 0;border:none;border-radius:8px;background:#2563eb;color:white;font-size:16px}
.roomBtn{padding:6px;margin:4px;background:#1e293b;border-radius:6px;display:block}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="authScreen">
  <div class="header">FunTimeChat Login</div>
  <div class="loginBox">
    <button class="btn" id="googleLogin">Login with Google</button>
    <button class="btn" id="guestLogin">Continue as Guest</button>
  </div>
</div>

<!-- CHAT -->
<div id="chatScreen" class="hidden">
  <div class="header" id="roomTitle">Public Room</div>

  <div id="messages"></div>

  <div class="sendBar">
    <input id="msgInput" placeholder="Type message...">
    <button id="sendBtn">Send</button>
  </div>

  <div class="bottomNav">
    <div class="navBtn" onclick="showRooms()">Rooms</div>
    <div class="navBtn" onclick="startRandom()">Random</div>
    <div class="navBtn">Inbox</div>
    <div class="navBtn" onclick="logout()">Logout</div>
  </div>
</div>

<!-- ROOMS -->
<div id="roomScreen" class="hidden">
  <div class="header">Rooms</div>
  <div id="roomList"></div>
  <center><button class="btn" onclick="backToChat()">Back</button></center>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

/* ✅ YOUR FIREBASE CONFIG SET */
const firebaseConfig = {
  apiKey: "AIzaSyB__tJ3sv3cB2N3vKHFCv8SYngJENQxwhY",
  authDomain: "funtimechat69-39947.firebaseapp.com",
  databaseURL: "https://funtimechat69-39947-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "funtimechat69-39947",
  storageBucket: "funtimechat69-39947.firebasestorage.app",
  messagingSenderId: "559638056734",
  appId: "1:559638056734:web:9329d2b561b6fab106830f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const authScreen = document.getElementById("authScreen");
const chatScreen = document.getElementById("chatScreen");
const roomScreen = document.getElementById("roomScreen");
const messages = document.getElementById("messages");
const msgInput = document.getElementById("msgInput");

document.getElementById("googleLogin").onclick = ()=>{
  const provider = new GoogleAuthProvider();
  signInWithPopup(auth, provider);
};

document.getElementById("guestLogin").onclick = ()=>{
  signInAnonymously(auth);
};

onAuthStateChanged(auth,user=>{
  if(user){
    authScreen.classList.add("hidden");
    chatScreen.classList.remove("hidden");
    loadMessages();
  }
});

function loadMessages(){
  const r = ref(db,"publicRoom");
  onChildAdded(r,snap=>{
    const m = snap.val();
    const div = document.createElement("div");
    div.className="msg";
    if(m.uid===auth.currentUser.uid) div.classList.add("me");
    div.innerText = m.name+": "+m.text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  });
}

document.getElementById("sendBtn").onclick=()=>{
  if(!msgInput.value.trim()) return;
  push(ref(db,"publicRoom"),{
    text:msgInput.value,
    name:auth.currentUser.displayName||"Guest",
    uid:auth.currentUser.uid,
    time:Date.now()
  });
  msgInput.value="";
};

window.showRooms=()=>{
  chatScreen.classList.add("hidden");
  roomScreen.classList.remove("hidden");
};

window.backToChat=()=>{
  roomScreen.classList.add("hidden");
  chatScreen.classList.remove("hidden");
};

window.logout=()=>{
  signOut(auth);
  location.reload();
};

window.startRandom=()=>{
  alert("Random Chat Part-3 me active hoga ✅");
};
</script>

</body>
</html>
